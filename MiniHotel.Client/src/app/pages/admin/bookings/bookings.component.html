<div class="container mt-5 py-5">
    <div
        class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-3">
        <h2 class="mb-0">Бронювання</h2>

        <div class="d-flex flex-wrap gap-2 align-items-center">
            <button class="btn btn-primary" (click)="createOfflineBooking()">
                Оформити офлайн-бронювання
            </button>

            <div class="form-floating">
                <input type="text" id="search" class="form-control" [(ngModel)]="searchTerm" (input)="applyFilter()"
                    placeholder="Пошук...">
                <label for="search">Пошук</label>
            </div>
        </div>
    </div>

    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z2 w-100">

        <ng-container matColumnDef="client">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Клієнт</th>
            <td mat-cell *matCellDef="let b">{{ b.fullName || b.user?.email || 'Невідомий клієнт' }}</td>
        </ng-container>

        <ng-container matColumnDef="roomNumber">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Номер</th>
            <td mat-cell *matCellDef="let b">{{ b.roomNumber }}</td>
        </ng-container>

        <ng-container matColumnDef="roomType">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Категорія номеру</th>
            <td mat-cell *matCellDef="let b">{{ b.roomCategory }}</td>
        </ng-container>

        <ng-container matColumnDef="dates">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Період</th>
            <td mat-cell *matCellDef="let b">
                {{ b.startDate | date:'dd.MM.yyyy' }} - {{ b.endDate | date:'dd.MM.yyyy' }}
            </td>
        </ng-container>

        <ng-container matColumnDef="startDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="d-none">Дата заїзду</th>
            <td mat-cell *matCellDef="let b" class="d-none">{{ b.startDate }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Статус</th>
            <td mat-cell *matCellDef="let b">
                {{ b.bookingStatus }}
            </td>
        </ng-container>

        <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Дії</th>
            <td mat-cell *matCellDef="let b">
                <div class="d-flex flex-column flex-md-row align-items-start gap-2">
                    <button mat-stroked-button color="primary" (click)="viewDetails(b.bookingId)">
                        Деталі
                    </button>

                    <div class="d-flex flex-wrap gap-2">
                        <button mat-flat-button color="accent" *ngIf="b.bookingStatus === BookingStatus.Pending"
                            (click)="confirm(b.bookingId)">
                            Confirm
                        </button>
                        <button mat-flat-button color="accent" *ngIf="b.bookingStatus === BookingStatus.Confirmed"
                            (click)="checkIn(b.bookingId)">
                            Check-in
                        </button>
                        <button mat-flat-button color="primary" *ngIf="b.bookingStatus === BookingStatus.CheckedIn"
                            (click)="checkOut(b.bookingId)">
                            Check-out
                        </button>
                        <button mat-flat-button color="warn"
                            [disabled]="b.bookingStatus !== BookingStatus.Pending && b.bookingStatus !== BookingStatus.Confirmed"
                            (click)="cancel(b.bookingId)">
                            Скасувати
                        </button>
                    </div>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>

    <mat-paginator [pageSize]="10"></mat-paginator>
</div>